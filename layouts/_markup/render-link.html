{{- /*
    Modified from Hugo embedded template:
    https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/_markup/render-link.html
*/}}

{{- $siteHost   := (urls.Parse site.BaseURL).Host }}
{{- $u          := urls.Parse .Destination }}
{{- $isExternal := and $u.IsAbs (ne $u.Host $siteHost) }}

{{- $href := $u.String -}}
{{- if strings.HasPrefix $u.String "#" -}}
    {{- $href = printf "%s#%s" .PageInner.RelPermalink $u.Fragment -}}
{{- else if and $href (not $u.IsAbs) -}}
    {{- $path := strings.TrimPrefix "./" $u.Path -}}
    {{- with or
        ($.PageInner.GetPage $path)
        ($.PageInner.Resources.Get $path)
        (resources.Get $path)
    -}}
        {{- $href = .RelPermalink -}}
        {{- with $u.RawQuery -}}
            {{- $href = printf "%s?%s" $href . -}}
        {{- end -}}
        {{- with $u.Fragment -}}
            {{- $href = printf "%s#%s" $href . -}}
        {{- end -}}
    {{- end -}}
{{- end -}}

<a href="{{ $href }}"
    {{- with .Title }} title="{{ . }}"{{- end -}}
    {{- if $isExternal }}
        {{- if site.Params.neso.page.ext_link_indicator }} class="ext-link"{{- end -}}
        {{- if site.Params.neso.page.ext_link_no_opener_referrer }} rel="external noreferrer noopener"{{- end -}}
        {{- if site.Params.neso.page.ext_link_new_window }} target="_blank"{{- end -}}
    {{ end -}}
>
    {{- .Text -}}
</a>
{{- /* chomp trailing newline */ -}}
